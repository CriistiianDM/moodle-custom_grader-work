'use strict';var _extends=Object.assign||function(a){for(var c,b=1;b<arguments.length;b++)for(var d in c=arguments[b],c)Object.prototype.hasOwnProperty.call(c,d)&&(a[d]=c[d]);return a};define(['jquery'],function(a,b){function c(){for(var t=window.location.search.split('='),u=-1,v=0;v<t.length;v+=2)'?id'===t[v]&&(u=t[v+1]);return u}function d(t,u,v){a.ajax({type:'POST',data:{course:t,element:u,type_e:v,type:'loadParentCat'},url:'managers/ajax_processing.php',success:function success(w){console.log(w),a('#padre').html(w.html)},dataType:'json',cache:'false',error:function error(w){console.log('ajax error'),console.log(w)}})}function f(t,u){var v=a('#tipoItem').val(),w=c();if('CATEGOR\xCDA'==v){if(l(t)){var x=a.trim(a('#inputNombre').val()),y=a('#inputValor').val(),z=g(a('#tipoCalificacion').prop('selectedIndex'));a.ajax({type:'POST',data:{course:w,parent:u,fullname:x,agregation:z,tipo:v,peso:y},url:'managers/ajax_processing.php',success:function success(A){1==A?(p({title:'Categoria a\xF1adida con exito',html:!0,type:'success',confirmButtonColor:m}),k(w)):0==A&&p({title:'Error al a\xF1adir la categoria (server error)',html:!0,type:'error',confirmButtonColor:m})},cache:'false',error:function error(A){p({title:'Error al intentar a\xF1adir la categoria',html:!0,type:'error',confirmButtonColor:m}),console.log(A)}})}}else if('\xCDTEM'==v){if(h(t)){var x=a.trim(a('#inputNombre').val()),y=a('#inputValor').val();a.ajax({type:'POST',data:{course:w,parent:u,fullname:x,tipo:v,peso:y},url:'managers/ajax_processing.php',success:function success(A){1==A?(p({title:'item a\xF1adido con exito',html:!0,type:'success',confirmButtonColor:m}),k(w)):0==A&&p({title:'Error al a\xF1adir el item (server error)',html:!0,type:'error',confirmButtonColor:m})},cache:'false',error:function error(A){p({title:'Error al intentar a\xF1adir el item',html:!0,type:'error',confirmButtonColor:m}),console.log(A)}})}}else if(!('PARCIAL'==v))p({title:'Seleccione el tipo de elemento que desea crear',html:!0,type:'warning',confirmButtonColor:m});else if(j(t)){var x=a.trim(a('#inputNombre').val()),y=a('#inputValor').val();a.ajax({type:'POST',data:{course:w,parent:u,fullname:x,agregation:6,tipo:v,peso:y},url:'managers/ajax_processing.php',success:function success(A){1==A?(p({title:'Categoria a\xF1adida con exito',html:!0,type:'success',confirmButtonColor:m}),k(w)):0==A&&p({title:'Error al a\xF1adir la categoria (server error)',html:!0,type:'error',confirmButtonColor:m})},cache:'false',error:function error(A){p({title:'Error al intentar a\xF1adir la categoria',html:!0,type:'error',confirmButtonColor:m}),console.log(A)}})}}function g(t){switch(t){case 1:return 0;break;case 2:return 10;}}function h(t){var u=a.trim(a('#inputNombre').val());if(''===u)return p({title:'Ingrese el nombre del \xEDtem que desea crear',html:!0,type:'warning',confirmButtonColor:m}),!1;if(10===t){var v=a('#inputValor').val();if(''===v)return p({title:'Ingrese un peso v\xE1lido entre 0 y '+maxweight,html:!0,type:'warning',confirmButtonColor:m}),!1}return!0}function j(t){var u=a.trim(a('#inputNombre').val());if(''===u)return p({title:'Ingrese el nombre del parcial que desea crear',html:!0,type:'warning',confirmButtonColor:m}),!1;if(10===t){var v=a('#inputValor').val();if(''==v)return p({title:'Ingrese un peso v\xE1lido entre 0 y '+maxweight,html:!0,type:'warning',confirmButtonColor:m}),!1}return!0}function k(t){a.ajax({type:'POST',data:{course:t,type:'loadCat'},url:'managers/ajax_processing.php',success:function success(u){a('#mymodalbody').html(u)},dataType:'text',cache:'false',error:function error(u){console.log(u)}})}function l(t){if(0==a('#tipoCalificacion').prop('selectedIndex'))return p({title:'Seleccione el tipo de calificaci\xF3n de la categor\xEDa que desea crear',html:!0,type:'warning',confirmButtonColor:m}),!1;var u=a.trim(a('#inputNombre').val());if(''==u)return p({title:'Ingrese el nombre de la categor\xEDa que desea crear',html:!0,type:'warning',confirmButtonColor:m}),!1;if(10==t){var v=a('#inputValor').val();if(''==v)return p({title:'Ingrese un peso v\xE1lido entre 0 y '+maxweight,html:!0,type:'warning',confirmButtonColor:m}),!1}else;return!0}var m='#d51b23',n={CATEGORY:'cat',ROW:'row'},o={cancelButtonClass:'swal-button-cancel',confirmButtonColor:m,confirmButtonClass:'swal-button-confirm'},p=function(t,u){var v=_extends({},t,o);return b(v,u)},q=function(t,u,v){return a.ajax({type:'POST',data:{type_ajax:'deleteElement',id:t,courseid:u,type:v},dataType:'json',cache:'false',url:'managers/ajax_processing.php'})},r=function(t,u,v,w,x){var y='No seleccionado';y=u===n.CATEGORY?'la categoria: '+v:'el item: '+v;var z='Esta seguro que desea eliminar '+y+'?';return p({title:z,text:'Tenga en cuenta que NO SE PODRAN RECUPERAR ninguna de la notas que haya registrado en este elemento una vez borrado!',type:'warning',showCancelButton:!0,confirmButtonClass:'btn-danger',confirmButtonText:'Aceptar, Borrar '+y,cancelButtonText:'Cancelar',closeOnCancel:!0},function(A){return A?(console.log('pos si0'),q(t,w,u).then(function(B){p({title:'Listo',text:B.msg,type:'success',showCancelButton:!1,showConfirmButton:!1,timer:2400}),k(w),x&&x()}).catch(function(B){console.log(B)})):(p({title:'Cancelado',type:'error',showCancelButton:!1,showConfirmButton:!1,timer:1200}),!1)})},s=function(){var t=a('<div class = \'divForm\' style= \'display:none\'>');return t.load('templates/categories_form.html'),t.toggle('slow','swing'),t};return{deleteElement:q,getCourseId:c,get_add_element_form:s,show_delete_element_dialog:r,ELEMENT_TYPES:n,init:function init(){var t,u;a(document).on('click','#wizard_button',function(){a('#modalCategories').modal({backdrop:!1}),a('.fondo').show()}),a(document).on('click','#tutorial-button',function(){a('#video-frame').attr('src','https://www.youtube.com/embed/8Bm_obAFBYo'),a('#tutorialModal').modal({backdrop:!1}),a('.fondo').show()}),a(document).on('click','#close-tutorial',function(){a('.fondo').hide()}),a('#tutorialModal').on('hidden.bs.modal',function(){a('#video-frame').attr('src','')}),a(document).on('click','#cancel',function(){a('.fondo').hide()}),a(document).on('click','.mymodal-close',function(){location.reload()}),a(document).on('click','.edit',function(){var v=a(this).attr('title');a('#titulo').text(v);var w=!1;a('#nombre_editar').show(),a('#label_nombre').show(),a('#alta').show(),a('#div_padres').show(),a(this).hasClass('curso')&&(w=!0,a('#alta').hide(),a('#nombre_editar').hide(),a('#label_nombre').hide(),a('#div_padres').hide());var x=c(),y=a(this).attr('id');if(a('#save_edit').attr('name',y),'Editar Categor\xEDa'===v){a('#type_cal').show();var z=a(this).parent().parent().attr('id');a('#otro').hide(),10!=z&&0!=z&&6!=z&&(z=99,a('#otro').show()),a('#calific').prop('value',z);var A=n.CATEGORY,B=a(this).parent().parent().text();if(-1==B.search('-')){var C=B.split('(');B=C[0],E=C[1],w||a('#peso').show(),E=E.replace('(',''),E=E.replace(')',''),E=E.replace(' ',''),E=E.replace('%',''),t=E,a('#peso_editar').val(E);var D=a(this).attr('data-maxweight');a('.maxweight-edit').attr('id',D)}else B=B.split('-')[0],a('#peso').hide()}else{a('#type_cal').hide();var E=a(this).parent().parent().prev().text();if('-'==E)a('#peso').hide(),a('#peso_editar').val(E);else{a('#peso').show(),E=E.replace('(',''),E=E.replace(')',''),E=E.replace(' ',''),E=E.replace('%',''),t=E,a('#peso_editar').val(E);var D=a(this).parent().attr('id');a('.maxweight-edit').attr('id',D)}var A='it',B=a(this).parent().parent().prev().prev().attr('title');'Enlazar a la actividad Tarea'==B&&(a('#nombre_editar').hide(),a('#label_nombre').hide())}a('#nombre_editar').val(B),d(x,y,A),a('#edit').modal({backdrop:!1}),a('.fondo').show()}),a(document).on('click','#save_edit',function(){var v=a(this).attr('name'),w=a('#nombre_editar').val(),x=a('#peso_editar').val(),y=parseFloat(a('.maxweight-edit').attr('id'))+parseFloat(t),z=a('#calific').val(),A=a('#padre').val();if('-'==x&&(x=0),'99'==z)return void p({title:'Tipo de Calificacion no valida.',text:'No es posible editar una categoria con un tipo de calificacion diferente a Promedio Simple, Promedio Ponderado, o Calificacion mas alta.\n Por favor seleccione uno de estos tipos de calificacion',html:!0,type:'warning',confirmButtonColor:m});if(x>y)return void p({title:'Peso no valido.',text:'El peso ingresado supera el peso m\xE1ximo posible de la categoria padre que es: '+y+'% \n Para crear un nuevo elemento primero configure los pesos de los demas.',html:!0,type:'warning',confirmButtonColor:m});if(''==w)return void p({title:'Ingrese el nuevo nombre del elemento',html:!0,type:'warning',confirmButtonColor:m});var B=a('#titulo').text();if('\xCDtem'==B.split(' ')[1]){var C='it';z=!1}else C=n.CATEGORY;var D=c();a.ajax({type:'POST',data:{course:D,element:v,type_e:C,newNombre:w,newPeso:x,newCalific:z,type:'editElement',parent:A},url:'managers/ajax_processing.php',success:function success(E){E.error?p('Error',E.error,'error'):(p({title:'Listo',text:E.msg,type:'success',showCancelButton:!1,showConfirmButton:!1,timer:1300}),a('#edit').modal('hide'),a('.fondo').hide(),k(D),console.log(E))},dataType:'json',cache:'false',error:function error(E){p('Server Error',E.error,'error'),console.log('AJAXerror'),console.log(E)}})}),a(document).on('click','.delete',function(){var v=a(this).parent().parent().parent().attr('id').split('_'),w=c(),x=a(this).attr('data-name'),y=v[1],z=v[0];r(y,z,x,w)}),a(document).on('click','.new',function(){if(u=a(this).parent().parent().children().next('.maxweight').attr('id'),0>=u)return void p({title:'No se pueden crear mas categor\xEDas o \xEDtems en la categoria seleccionada.',text:'\n\r El peso de los elementos dentro de \xE9sta suma 100%.\n\r Para crear un nuevo elemento primero configure los pesos de los demas.',html:!0,type:'warning',confirmButtonColor:m});a('.new').prop('disabled',!0),a('.delete').prop('disabled',!0),a('.edit').prop('disabled',!0);var v=a(this).parent().parent();v.append('<hr style = "margin: 6px 0;border-top: 1px solid #ddd">');var w=s();v.append(w),window.setTimeout(function(){var x=v.attr('id');10==x&&(a('#divPeso').show(),a('#inputValor').on('blur',function(){var y=a(this).val(),z=parseInt(a(this).parent().parent().parent().parent().children().next('.maxweight').attr('id'));(0>y||y>z)&&(p({title:'El valor debe estar entre 0 y el peso m\xE1ximo: '+z,text:'\n\rUsted ingres\xF3: '+y,html:!0,type:'warning',confirmButtonColor:m}),a(this).val(''))}),a('#inputValor').on('keypress',function(y){var z=document.all?y.keyCode:y.which;if(8==z||46==z)return!0;var A=/[0-9]/,B=String.fromCharCode(z);return A.test(B)})),a('#tipoItem').on('change',function(){var y=a(this).prop('selectedIndex');1==y?a('#divTipeC').show():a('#divTipeC').hide()}),a('#save').on('click',function(){var y=a(this).parent().parent().parent().parent().attr('id'),z=a(this).parent().parent().parent().parent().parent().attr('id');z=z.split('_')[1],f(y,z)}),a('#cancel').on('click',function(){var y=c();k(y)})},400)})}}});